# 네트워크 용어 정리

## 노드와 호스트

출처: https://blog.naver.com/myca11/221369799273

네트워크에 연결된, 네트워크 공간 상에 있는 모든 종류의 장치를 노드(Node)라고 부릅니다.
그리고 노드 중에서도 네트워크 주소(IP 주소)가 할당된 애들을 호스트(Host)라고 부릅니다.

호스트가 아닌 노드의 예로, 모뎀, 허브, 스위치 등등이 있습니다. 이 장치들은 네트워크를 이용하는 것이 아니라, 네트워크 상에서 호스트끼리 데이터를 주고받을 때, 그 데이터를 전달하는 중간자 역할을 하는 장치들입니다. 그래서 이 장치들은 네트워크 상에서 '유일한 값'인 네트워크 주소가 없어도 동작할 수 있습니다.

## 서버와 클라이언트

서버란, 요청에 응답할 수 있는 호스트를 의미합니다.
서버도 네트워크 상에서 노드이며, 네트워크를 이용하기 위한 장치이며, 이를 위해 네트워크 주소가 할당됩니다.
호스트와 노드 관계처럼, 모든 서버는 호스트이지만, 모든 호스트가 서버인 것은 아닙니다.

요청을 보내는 호스트는 클라이언트(Client)라고 합니다.

서버와 클라이언트는 역할이 한번 정해지면 끝이고 바뀔 수 없다고 생각하면 안 됩니다. 서버이기도 하지만 동시에 클라이언트일 수도 있습니다. 그리고 클라이언트이지만 동시에 서버일 수도 있습니다. 예를 들어, 실제 네트워크 환경에서는 서버가 서버를 호출하는 경우도 있는데 이때는 호출한 서버가 클라이언트가 됩니다. (보통 이런 경우 서버투서버 라고 부릅니다)

주의할 점은 서버와 호스트를 동의어로 쓰기도 한다는 것입니다. 호스트라는 영어 단어가 가지고 있는 본래의 의미 때문인데, 그때그때 융통성 있게 문맥에 따라 잘 해석해야 합니다.


# 전송계층(Transport Layer) 기본 개념

출처: https://blog.naver.com/myca11/221389847130

## 프로세스

스마트폰 내부에서는 여러 앱이 동시에 동작하죠. 예를 들어 우리는 멜론으로 음악을 들으면서 카톡을 할 수 있습니다.<br>
여기서 스마트폰은 호스트(Host)고 앱은 프로세스(Process)입니다.

네트워크를 통해 데이터를 주고 받을 때 우리는 연결된 호스트와 호스트 간에 통신을 통해 데이터가 오간다고 알고 있습니다.<br>
하지만 실제로 데이터를 주고 받는 주체는 호스트 내부의 프로세스입니다.

친구에게 카톡을 보내면 그 메세지(데이터)는 친구의 스마트폰(호스트)의 카톡 앱(프로세스)에 전달됩니다.

즉, 데이터가 네트워크를 타고 목적지 호스트에 도착했다고 끝이 아니라,<br>
그 호스트에서 동작하는 여러 프로세스 중에 실제로 이 데이터를 받아야 하는 프로세스까지 전달되야 합니다.<br>
그리고 이를 달성하기 위해 포트가 등장합니다.

정리
1. 데이터는 프로세스 레벨에서 주고 받는다.
2. 호스트에서는 여러 프로세스가 동시에 동작한다.
3. 상대 프로세스에서 전송한 데이터는 나의 호스트에서 동작하는 여러 프로세스 중에 특정한 프로세스까지 전달되야 한다.

## 포트

포트(Port)는, 네트워크를 통해 데이터를 주고받는 프로세스를 식별하기 위해 호스트 내부적으로 프로세스가 할당받는 고유한 값입니다.

이 값은 숫자로 표현되기 때문에, 포트 넘버(Port number)라고도 합니다. 데이터를 담고 있는 편지봉투에 목적지의 포트가 28080으로 적혀있다면, 목적지 호스트에 도착한 뒤에 해당 호스트에서 28080 포트를 할당받은 프로세스를 찾아서 데이터를 전달해야 합니다.

포트는 받는 쪽, 보내는 쪽 프로세스 모두 할당받아야 합니다. 

## 소켓

소켓(Socket)은, 프로세스가 네트워크를 통해서 데이터를 주고받으려면 반드시 열어야 하는 창구 같은 것입니다.

보내는 쪽이 소켓이라는 창구를 열고 소켓을 통해서 데이터를 보내면 네트워크 모델에 따라 목적지 호스트에 데이터가 도착하게 되고, 데이터를 담은 봉투에 써진 도착지의 포트 넘버와 같은 포트를 할당받은 프로세스를 찾아서, 그 프로세스의 소켓을 통해 해당 프로세스에 데이터를 전달합니다.

소켓을 열기 위해선 호스트에 할당된 IP 주소, 포트 넘버, 프로토콜(Protocol) 등이 필요하며, 이 세 가지가 소켓을 정의합니다. 여기서 말하는 프로토콜은 전송계층 프로토콜로, 대표적으로 TCP, UDP가 있습니다.

### 소켓은 하나가 아니다

같은 프로세스가 같은 포트를 가지고도 여러 개의 소켓을 열 수 있습니다. 즉, 하나의 프로세스는 같은 프로토콜, 같은 IP 주소, 같은 포트 넘버를 가지는 수십 혹은 수만 개의 소켓을 가질 수 있는거죠.

덕분에 하나의 프로세스는 하나의 포트만으로도 다른 여러 호스트에 있는 프로세스의 요청을 처리할 수 있고, 게임 서버의 동시 접속자 수가 수십수백만이 될 수 있는 것입니다.

소켓을 정의하는 것과 소켓을 식별하는 것은 구분됩니다. IP 주소, 포트 넘버, 프로토콜로 소켓을 정의할 수 있지만, 이것이 소켓을 유일하게 식별하진 않습니다. 같은 IP 주소, 포트 넘버, 프로토콜로 정의된 여러 개의 소켓이 존재할 수 있습니다.


### 소켓의 식별과 연결

여러 개의 소켓이 같은 프로세스에 대해서 같은 프로토콜, 같은 IP 주소, 같은 포트 넘버를 가질 수 있다면, 데이터가 도착했을 때 어떤 소켓으로 가야 하는지 어떻게 알까요?

같은 포트 ip 주소, protocol에 대해서 여러 개의 소켓이 존재할 수 있지만, 연결(connection)을 맺기 전에 요청을 기다리는 Listening 상태는 오직 한 socket만 존재할 수 있습니다. 그렇기 때문에 처음 연결을 요청하는 데이터는 단 하나의 Listening 상태인 소켓으로 갈 수 있는 것이죠.

연결이 확립된 이후의 데이터를 받는 경우에는, socket식별을 연결(connection) 정보로 합니다. 즉, 데이터를 보낸 쪽의 ip 주소와 포트 넘버, 데이터를 받는 쪽의 ip 주소와 포트 넘버를 활용해서 어느 소켓으로 데이터가 가야할 지를 식별할 수 있는 것이죠.

### Q&A

Q. 서버측에서 8080포트에 100만개의 소켓을 만들어놨다고 하면 100만명의 사람들이 동시접속 할 수 있는건가요?

A. tcp 기준으로 서버는 미리 100만개의 소켓을 열어두지 않습니다. 소켓 중에서 리스닝 소켓으로도 불리는 서버 소켓이라는 것이 있는데 얘는 하나만 열어두고 얘가 요청이 받을 때 마다 실제로 커넥션을 맺고 통신할 수 있는 소켓을 만드는 형태로 동작합니다. 그러므로 미리 몇 백만개 소켓을 만들어두고 사용하는 것은 아니구요, 요청에 따라 실시간으로 소켓을 만든다고 생각하면 되겠습니다.

Q. 소켓을 하나의 창구로 비유하셨는데 하나의 프로세스로 연결되는 하나 이상의 접속점이라고 생각하면 될까요?
예를 들어서 A라는 게임을 실행하는 프로세스가 있고, 이 게임의 포트번호는 10000이라고 한다면 게임 유저들이 이 프로세스로 들어올 때 IP와 포트번호는 동일한 것을 사용하지만, 소켓을 여러 개 열어두어 각각의 접속 효율을 높이는 것이라고 보는 건가요?

A. 서버의 입장에서는 같은 포트를 사용함에도, 한 프로세스 안에서 동시에 여러 개의 요청을 처리할 수 있습니다. (서버 레벨에서 요청 처리를 위해서, 요청마다 thread 를 할당하는 방식이 있고, event-loop 로 처리하는 방식이 있습니다만, 설명이 길어질 수 있으니 생략합니다.) 이는 한 port에 listening server socket을 열어두고, 요청이 들어올 때마다, 같은 port 번호를 사용하는 또다른 socket을 열고 커넥션을 완성시킵니다. 이후에는 해당 커넥션 상에서 요청이 오기 때문에, 같은 port 번호로 보낸다할지라도, 보내는 쪽의 ip와 port가 다르기 때문에, 어느 socket으로 가야할 지 식별할 수 있는 것이죠.