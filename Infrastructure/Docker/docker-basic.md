# 도커 기본

## 도커 run 옵션
https://www.daleseo.com/docker-run/

### --name
컨테이너의 이름을 지정.
name을 지정하지 않고 실행한다면 도커가 임의로 이름을 만들지만 우리가 이해하기 쉬운 이름을 꼭 붙여주자.
도커 네트워크의 bridge모드에선 컨테이너를 링크시킬 때 name을 참조한다.

### -p (포트 포워딩)
컨테이너와 호스트의 포트를 연결.

도커 컨테이너는 NAT 내부망에서 동작하고 공인IP주소가 아닌 사설IP주소를 사용하기 때문에 컨테이너 외부에서 내부로 접속할 수 없다.
이를 극복하기 위해 포트 포워딩 기법이 사용됨.
> 포트포워딩이란?<br>
라우터/게이트웨이의 특정 포트 번호로 유입되는 트래픽을 NAT 내부에서 동작하는 시스템의 특정 포트로 전달해 주는 기법.<br>
예) 홈서버를 구축할 때, 집 공유기의 80포트로 접속하는 모든 트래픽을 내 PC(사설IP)의 8080포트로 전달하도록 설정 할 수 있음.

다음과 같이 -p 옵션을 사용하여 호스트와 컨테이너의 포트
도커에서 호스트는 도커엔진이 구동중인 물리 컴퓨터(내 PC)이다.
```
$ docker run -p <host port number>:<container port number>/<protocol> [IMAGE NAME] [OTHER OPTIONS...]
```
- 예) `-p 80:8080`으로 실행 시 호스트의 8080포트로 들어오는 트래픽은 모두 tcp프로토콜을 통해 해당 컨테이너의 8080포트로 전달된다.
- `<protocol>`은 tcp, udp 등을 넣을 수 있고 디폴트는 tcp이다.

참고: https://tttsss77.tistory.com/155

### -v (볼륨,바인드 마운트)
컨테이너와 호스트의 디렉토리를 연결.

기본적으로 컨테이너에 쓰여진 데이터는 컨테이너가 삭제될 때 함께 삭제된다.
컨테이너가 삭제되어도 데이터가 남아있게 하기위한 방법은 `볼륨`, `바인드 마운트` 두 가지가 있다.
둘 다 컨테이너의 디렉토리와 호스트의 디렉토리를 연결(마운트)해주는 기능이다.
둘 다 `-v`옵션으로 설정할 수 있다.

![image](https://user-images.githubusercontent.com/56679885/130664384-17a6b2b7-6988-4c27-a592-b6b64d865ff9.png)

#### 1. 볼륨
위의 사진에서 볼 수 있다시피, 볼륨과 바인드 마운트 둘 다 호스트의 디렉터리(파일 시스템)안에 위치하고 있다.
대신 볼륨은 도커에서 마운트 포인트를 관리해주고, 편한 기능들을 제공해주기 때문에 도커에서는 볼륨의 사용을 권장하고 있다.

볼륨 생성
```
$ docker volume create my-vol <volume name>
```

볼륨을 컨테이너에 마운트
```
$ docker run -v <volume name>:<container directory path> [IMAGE NAME] [OTHER OPTIONS...]
```

- 하나의 볼륨을 여러 컨테이너에 마운트해서 공용으로 사용할 수도 있다.
- 볼륨을 삭제하려면 먼저 마운트되어 있는 컨테이너를 모두 중지시켜야한다.

#### 2. 바인드 마운트
바인드 마운트를 사용하면 호스트 파일 시스템의 특정 경로를 컨테이너로 바로 마운트할 수 있다.
컨테이너를 실행할 때 `-v` 옵션의 `:`앞에 볼륨 이름 대신 마운트할 호스트의 디렉토리를 넣으면 된다.

```
$ docker run -v <host directory path>:<container directory path> [IMAGE NAME] [OTHER OPTIONS...]
```

참고: https://www.daleseo.com/docker-volumes-bind-mounts/

### -d (Detached 모드)
컨테이너를 백그라운드(Detached 모드)에서 실행. 도커 실행은 Foreground/Detached 모드가 있는데 Foreground가 디폴트다. Foreground 모드에도 여러 옵션들이 있지만 대부분 백그라운드에서 실행하니 패스.
-d 옵션을 붙이지 않고 실행한다면, `^C`로 프로세스 중지시 컨테이너가 중지된다.
