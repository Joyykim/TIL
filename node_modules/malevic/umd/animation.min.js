/* malevic@0.18.0 - Feb 7, 2020 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("malevic/dom"),require("malevic/string")):"function"==typeof define&&define.amd?define(["exports","malevic/dom","malevic/string"],n):n(((t=t||self).Malevic=t.Malevic||{},t.Malevic.Animation={}),t.Malevic.DOM,t.Malevic.String)}(this,function(t,i,o){"use strict";var r=function(){return(r=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};function a(t){return null!=(n=t)&&"object"==typeof n&&Object.getPrototypeOf(t)===Object.prototype;var n}function g(t,n){return void 0===n&&(n=0),t[t.length-1-n]}function l(t,n,e){return n*(1-t)+e*t}function u(n,e){return function(t){return l(t,n,e)}}function n(t){for(var n,e=[],i=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[e][-+]?\d+)?/gim;n=i.exec(t);)e.push({index:n.index,length:n[0].length});return e}function s(r,o){var u=n(r),a=n(o);return function(t){for(var n="",e=0,i=0;i<a.length;i++)n+=o.substring(e,a[i].index),n+=l(t,parseFloat(r.substr(u[i].index,u[i].length)),parseFloat(o.substr(a[i].index,a[i].length))).toString(),e=a[i].index+a[i].length;return n+=o.substring(e)}}function e(t){return t}var c={delay:0,duration:250,easing:"ease"},p=(f.prototype.initial=function(t){return this.$spec.initial=t,this},f.prototype.from=function(t){if(0<this.$spec.timeline.length)throw new Error("Starting keyframe was already declared");return this.$spec.timeline.push({from:t,to:null,timing:r({},c)}),this},f.prototype.to=function(t,n){this.$spec.interpolate||("number"==typeof t?this.$spec.interpolate=u:"string"==typeof t&&(this.$spec.interpolate=s));var e=g(this.$spec.timeline);return e&&null==e.to?(e.to=t,n&&(e.timing=r(r({},e.timing),n))):this.$spec.timeline.push({from:e?e.to:null,to:t,timing:r(r({},c),n||{})}),this},f.prototype.interpolate=function(t){return this.$spec.interpolate=t,this},f.prototype.output=function(t){return this.$spec.output=t,this},f.prototype.done=function(t){return this.$spec.done=t,this},f.prototype.spec=function(){return this.$spec},f);function f(){this.$spec={initial:null,timeline:[],interpolate:null,output:e,done:null}}function h(t,n,e){if(null!=e&&""!==e){var i=String(e),r="";i.endsWith("!important")&&(i=i.substring(0,i.length-10),r="important"),t.style.setProperty(n,i,r)}else t.style.removeProperty(n)}var y={linear:function(t){return t},ease:function(t){var n=(1-Math.cos(t*Math.PI))/2,e=Math.sqrt(1-Math.pow(t-1,2)),i=Math.sin(t*Math.PI/2);return n*(1-i)+e*i},"ease-in":function(t){var n=1-Math.cos(t*Math.PI/2);return 1-1e-15<n?1:n},"ease-out":function(t){return Math.sin(t*Math.PI/2)},"ease-in-out":function(t){return(1-Math.cos(t*Math.PI))/2}},m=(v.prototype.tick=function(t){null==this.startTime&&(this.startTime=t);for(var n,e=t-this.startTime,i=this.timeline,r=i.length-1;0<=r;r--){var o=i[r],u=o.standby,a=o.end;if(a<=e||u<=e&&e<=a){n=i[r];break}}var l=n.start,s=n.end,c=n.spec;n===g(i)&&s<=e&&(this.isComplete=!0),n.interpolate||(n.interpolate=this.interpolate(c.from,c.to));var f,p,h,m=("string"==typeof c.timing.easing?y[c.timing.easing]:c.timing.easing)(e<l?0:l===s?1:(f=(e-l)/(s-l),p=0,h=1,Math.min(h,Math.max(p,f)))),v=n.interpolate.call(null,m);this.lastValue=v;var d=this.output.call(null,v);this.callback.call(null,d)},v.prototype.value=function(){return this.lastValue},v.prototype.complete=function(){return this.isComplete},v.prototype.finalize=function(){this.doneCallback&&this.doneCallback.call(null)},v);function v(t,n){if(!t.interpolate)throw new Error("No interpolator provided");this.interpolate=t.interpolate,this.output=t.output,this.callback=n,this.doneCallback=t.done;var i=0;this.timeline=t.timeline.map(function(t){var n=i+t.timing.delay,e=n+t.timing.duration;return{standby:i,start:n,end:i=e,spec:t,interpolate:null}}),this.isComplete=!1}var d,b,M,O,j=(b=d=null,M=!1,O=[],{run:function(){M=!0,d=performance.now(),b=requestAnimationFrame(k)},stop:function(){cancelAnimationFrame(b),d=b=null,M=!1},tick:function(t){O.push(t)},time:function(){return d},running:function(){return M}});function k(){d=performance.now(),O.forEach(function(t){return t(d)}),M&&(b=requestAnimationFrame(k))}function w(t,n){t.tick(n),t.complete()&&(x(t),t.finalize())}j.tick(function(n){return Array.from(A.values()).forEach(function(t){return w(t,n)})});var $=new WeakMap,A=new Set;function x(t){A.delete(t),0===A.size&&j.stop()}function P(t){var n=$.get(t);return n&&A.has(n)?n:null}function E(t){return a(t)&&Object.values(t).some(function(t){return t instanceof p})}function C(t,n,e){var i,r,o,u,a,l=t.spec(),s=l.timeline[0].from,c=g(l.timeline).to;if(n instanceof p){var f=P(n);if(f)x(f),i=f.value();else i=g(n.spec().timeline).to}else typeof n==typeof c&&null!=n&&null!=c&&n.constructor===c.constructor&&(i=n);(null!=s?r=s:null!=i?r=i:null!=l.initial&&(r=l.initial),null==r)?e(l.output(c)):(l.timeline[0].from=r,u=e,a=new m((o=t).spec(),u),A.add(a),$.set(o,a),j.running()||j.run(),w(a,j.time()))}function S(t){if(t instanceof p){var n=P(t);n&&x(n)}}function q(t){var n=t.element,e=t.attr,i=t.value,r=t.prev;return i instanceof p?(C(i,r,function(t){return n.setAttribute(e,t)}),!0):(E(r)?Object.values(r).forEach(function(t){return S(t)}):S(r),null)}function F(t){var r=t.element,n=t.attr,e=t.value,i=t.prev;if("style"===n){if(E(e)){var o,u=e;return a(i)?(o=i,Object.keys(o).filter(function(t){return!u.hasOwnProperty(t)}).forEach(function(t){S(o[t]),h(r,t,null)})):(o={},r.removeAttribute("style"),S(i)),Object.entries(u).forEach(function(t){var n=t[0],e=t[1],i=o[n];e instanceof p?C(e,i,function(t){h(r,n,t)}):(S(i),h(r,n,e))}),!0}E(i)&&Object.values(i).forEach(function(t){return S(t)})}return null}function I(t){return t.output(null!=t.timeline[0].from?t.timeline[0].from:null!=t.initial?t.initial:g(t.timeline).to)}function T(t){var n=t.value;if(n instanceof p){var e=n.spec();return o.escapeHTML(String(I(e)))}return null}function z(t){var n,e=t.attr,i=t.value;if("style"===e&&E(i)){var r={};return Object.keys(i).forEach(function(t){var n=i[t];if(n instanceof p){var e=n.spec();r[t]=I(e)}else r[t]=n}),o.escapeHTML((n=r,Object.keys(n).filter(function(t){return null!=n[t]}).map(function(t){return t+": "+n[t]+";"}).join(" ")))}return null}t.animate=function(t,n){var e=new p;return null!=t&&e.to(t,n),e},t.withAnimation=function(t){if(i){var n=i.plugins;n.setAttribute.add(t,q),n.setAttribute.add(t,F)}if(o){var e=o.plugins;e.stringifyAttribute.add(t,T),e.stringifyAttribute.add(t,z)}return t},Object.defineProperty(t,"__esModule",{value:!0})});
