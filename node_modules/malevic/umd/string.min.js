/* malevic@0.18.0 - Feb 7, 2020 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(((t=t||self).Malevic=t.Malevic||{},t.Malevic.String={}))}(this,function(t){"use strict";function n(){var o=[];return{add:function(t){return o.push(t),this},apply:function(t){for(var n,r,e=new Set,i=o.length-1;0<=i;i--)if(r=o[i],!e.has(r)){if(null!=(n=r(t)))return n;e.add(r)}return null},delete:function(t){for(var n=o.length-1;0<=n;n--)if(o[n]===t){o.splice(n,1);break}return this},empty:function(){return 0===o.length}}}function u(e,t,i){t.filter(function(t){var n=t[0];return e[n]}).forEach(function(t){var n=t[0],r=t[1];return e[n].forEach(function(t){return i(r,t)})})}function r(r){var e={add:function(t,n){return t[r]||(t[r]=[]),t[r].push(n),e}};return e}function i(t){return null!=t&&"object"==typeof t}function c(t){return i(t)&&null!=t.type&&null==t.nodeType}function o(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=[];return t.filter(function(t){return Boolean(t)}).forEach(function(n){"string"==typeof n?r.push(n):"object"==typeof n&&r.push.apply(r,Object.keys(n).filter(function(t){return Boolean(n[t])}))}),r.join(" ")}function a(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var e=Symbol(),f=n();function l(t,n){if(!f.empty()){var r=f.apply({attr:t,value:n});if(null!=r)return r}var e;return"class"===t&&i(n)?a(Array.isArray(n)?o.apply(void 0,n):o(n)):"style"===t&&i(n)?a((e=n,Object.keys(e).filter(function(t){return null!=e[t]}).map(function(t){return t+": "+e[t]+";"}).join(" "))):!0===n?"":a(String(n))}var p=Symbol(),s=n(),h=new Set(["key","oncreate","onupdate","onrender","onremove"]);var d=function(t,n){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,n)};function y(t,n){function r(){this.constructor=t}d(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var v=Symbol(),g=n();var m=new Set(["area","base","br","col","embed","hr","img","input","link","menuitem","meta","param","source","track","wbr"]),b=null;function w(t){var n=t.type,r=t.props,e=t.children,i=b;b={};var o=n.apply(void 0,function(){for(var t=0,n=0,r=arguments.length;n<r;n++)t+=arguments[n].length;var e=Array(t),i=0;for(n=0;n<r;n++)for(var o=arguments[n],u=0,a=o.length;u<a;u++,i++)e[i]=o[u];return e}([r],e));return b=i,o}function j(){}var E=[[e,f],[p,s],[v,g]];function x(t,n){return"".padEnd(t.length*n,t)}var A,_=(y(S,A=j),S.prototype.stringify=function(t){var n=t.indent,r=t.depth,e=[],i=x(n,r),o=Array.from(this.attrs.entries()).map(function(t){var n=t[0],r=t[1];return""===r?n:n+'="'+r+'"'}).join(" "),u=i+"<"+this.tag+(o?" "+o:"")+">";if(this.isVoid)e.push(u);else{var a="</"+this.tag+">";0===this.children.length?e.push(u+a):1===this.children.length&&this.children[0]instanceof k&&!this.children[0].text.includes("\n")?e.push(u+this.children[0].stringify({indent:n,depth:0})+a):(e.push(u),this.children.forEach(function(t){return e.push(t.stringify({indent:n,depth:r+1}))}),e.push(i+a))}return e.join("\n")},S);function S(t){var e=A.call(this)||this;return e.children=[],e.tag=t.type,e.attrs=new Map,Object.entries(t.props).filter(function(t){return!function(t,n){if(!s.empty()){var r=s.apply({attr:t,value:n});if(null!=r)return r}return h.has(t)||t.startsWith("on")||null==n||!1===n}(t[0],t[1])}).forEach(function(t){var n=t[0],r=t[1];return e.attrs.set(n,l(n,r))}),e.isVoid=function(t){if(!g.empty()){var n=g.apply(t);if(null!=n)return n}return m.has(t)}(e.tag),e}var O,k=(y(M,O=j),M.prototype.stringify=function(t){var n=x(t.indent,t.depth);return""+n+this.text.replace(/\n/g,"\n"+n)},M);function M(t){var n=O.call(this)||this;return n.text=a(t),n}var P,T=(y(V,P=j),V.prototype.stringify=function(t){return x(t.indent,t.depth)+"\x3c!--"+this.text+"--\x3e"},V);function V(t){var n=P.call(this)||this;return n.text=a(t),n}function B(t,n){if(c(o=t)&&"string"==typeof o.type){var r=new _(t);n.children.push(r),t.children.forEach(function(t){return B(t,r)})}else if(c(i=t)&&"function"==typeof i.type){if(t.type===Array)t.children.forEach(function(t){return B(t,n)});else u(t.type,E,function(t,n){return t.add(n)}),B(w(t),n),u(t.type,E,function(t,n){return t.delete(n)})}else if("string"==typeof t){var e=new k(t);n.children.push(e)}else if(null==t){e=new T("");n.children.push(e)}else{if(!Array.isArray(t))throw new Error("Unable to stringify spec");t.forEach(function(t){return B(t,n)})}var i,o}var q={stringifyAttribute:r(e),skipAttribute:r(p),isVoidTag:r(v)};t.escapeHTML=a,t.isStringifying=function(){return null!=b},t.plugins=q,t.stringify=function(t,n){var r,e,i=void 0===n?{}:n,o=i.indent,u=void 0===o?"    ":o,a=i.depth,f=void 0===a?0:a;if(c(t))return(r=t,e=new _({type:"div",props:{},children:[]}),B(r,e),e.children).map(function(t){return t.stringify({indent:u,depth:f})}).join("\n");throw new Error("Not a spec")},Object.defineProperty(t,"__esModule",{value:!0})});
