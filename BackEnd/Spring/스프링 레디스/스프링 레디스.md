# 스프링에서 Redis 사용하기

### build.gradle에 의존성 추가
```
implementation 'org.springframework.boot:spring-boot-starter-data-redis'
```

### RedisTemplate vs Repository
데이터를 레디스에서 CRUD할 때 두가지 방식이 있다.
- RedisTemplate: 비교적 Low한 방식으로 직접 키값으로 밸류를 set, get하는 방식. 자유도가 높지만 코드가 지저분해지고 통제가 안될 수 있음.
- Repository: 비교적 추상화된 방식. JPA를 쓰는 것과 비슷한 방식으로 클래스를 엔티티로 만들고 객체를 저장, 관리할 수 있음. 

## Repository 사용법

### 클래스를 Redis 엔티티로 만들기

#### @RedisHash
클래스를 선언하고 `@RedisHash`를 붙이면 해당 클래스는 인스턴스를 레디스에 저장할 수 있게 됨. JPA의 `@Entity` 느낌!
프로퍼티는 `value`, `timeToLive`가 있다. 
- value(String): 엔티티가 레디스에 저장될 때의 키값(KeySpace)를 지정. 보통 클래스이름을 쓴다.
- timeToLive(long): 데이터가 레디스에 얼만큼의 시간동안 저장되어 있을지(TTL;time to live)를 지정.
  - `-1`로 지정하면 지워지지 않는다. default는 -1. 단위는 초. (10으로 설정하면 객체가 저장된 후 10초 뒤 자동으로 삭제된다.)

#### @Id
Id로 지정할 필드에 붙인다. 보통 String으로 선언하지만 다른 타입도 가능.
Id타입이 String타입일때 엔티티의 id를 null로 주면 레디스에서 UUID값을 만들어서 넣어줌.
Long으로 선언하면 랜덤 정수?를 넣어주는 듯.

id라는 필드가 있으면 `@Id`어노테이션을 생략해도 해당 필드가 Id로 인식이 되더라?! 하지만 왜 되는건지 근거를 찾지 못함.
물론 어노테이션도 달지 않고 id필드도 없으면 에러남.

### Repository 생성
보통 JPA를 쓰는 것과 비슷하게 사용할 수 있다. `CrudRepository`를 생성
만약 `Person`이라는 클래스가 있고 id타입이 String이라면 아래처럼 생성가능.
```
public interface PersonRepository extends CrudRepository<Person, String> {
}
```

